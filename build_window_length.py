import numpy as np
import matplotlib.pyplot as plt

# The different lenghts were found using the window_analysis script.
# This script is only used to concatenate the data on a single graph

length_1_23 = [211.09693878, 280.15306122,  332.5,         443.7755102,  493.87755102,
                545.73979592, 592.01530612, 561.73469388, 605.76530612, 656.55612245,
                705.35714286, 804.08163265, 849.31122449, 896.60714286, 946.2755102,
                641.19897959, 688.23979592, 737.5255102, 785.68877551, 880.35714286,
                923.44387755, 971.50510204, 1021.19897959]

# 24-93 -> 23 = 1054.35204082 in this round
length_24_93 = [ 1034.73469388, 1075.70408163, 1123. ,        1180.90816327,
                1278.99489796, 1329.12244898 ,1378.48469388, 1431.08673469, 1272.20918367,
                1323.6377551,  1369.68367347, 1508.        , 1525.06632653, 1569.14795918,
                1618.45918367 ,1669.53061224, 1635.90816327, 1682.3877551 , 1734.93877551,
                1781.82653061, 1880.88265306 ,1927.33673469, 1973.71428571, 2031.7244898,
                1724.07142857, 1769.40306122 ,1816.36734694 ,1859.45408163, 1958.0255102,
                2007.05612245, 2054.47959184 ,2104.04591837 ,2075.83163265, 2119.98979592,
                2164.07142857 ,2210.4744898,  2313.79081633 ,2358.6377551 , 2404.12244898,
                2458.76530612 ,2468.73979592, 2514.8877551  ,2563.84183673, 2623.51020408,
                2718.68877551, 2760.04081633, 2812.64285714 ,2854.14795918, 2820.21938776,
                2866.41836735, 2919.14795918, 2968.71428571 ,3065.4744898 , 3115.65306122,
                3176.49489796 ,3217.33673469, 2900.09183673 ,3214.30102041, 3003.96938776,
                3046.21428571 ,3145.42346939, 3201.75       ,3251.26530612, 3293.94387755,
                3263.73979592 ,3300.90816327, 3357.28571429 ,3396.7755102,  3497.77040816,
                3549.19897959]

# 94 - 126
# TODO: Recompute this one
length_94_126 = [3671.54591837, 3655.14285714, 3500.75510204, 3545.27040816, 3662.89795918,
                3666.82653061, 3723.89285714, 3773.91836735, 3820.01530612, 3860.60204082,
                3833.68877551, 3883.86734694, 3929.12244898, 3968.76530612, 4059.47959184,
                4105.93367347, 4153.51020408, 4199.2244898 , 3908.79081633, 3955.24489796,
                3992.66836735, 4048.43367347, 4140.06632653, 4187.3877551,  4228.6377551,
                4263.        , 4250.24489796, 4308.        , 4366.       ,  4424.,
                4482.        , 4540.        , 4598.]    # Last 6 points were extraploted

length_127_128 = [4656.96428571, 3560.99489796]

length_129_154 =[3594.65306122, 3651.56632653, 3698.04591837,
 3795.80102041, 3834.42346939, 3884.93367347, 3942.43367347, 3915.06122449,
 3955.92857143, 4005.1122449,  4047.53571429, 4148.8877551,  4193.17346939,
 4242.81632653, 4288.17346939, 3987.6377551,  4034.57653061, 4078.42857143,
 4123.76020408, 4223.47959184, 4270.23979592, 4312.6122449,  4353.35204082,
 4327.73979592, 4369.60204082]

#154 = 4411.51530612
length_155_188 = [ 4467.99489796, 4551.82142857, 4600.39285714, 4649.67857143,
 4693.55612245, 4553.65816327, 4596.61734694, 4643.76020408, 4688.53061224,
 4785.52040816, 4832.35714286, 4881.15816327, 4912.89285714, 4887.58673469,
 4945.34183673, 4997.71428571, 5032.99489796, 5136.84693878, 5175.54591837,
 5224.32142857, 5256.54081633, 4973.14795918, 5019.27040816, 5071.20918367,
 5105.26530612, 5188.76020408, 5247.99489796, 5291.82142857, 5338.73469388,
 5302.22959184, 5348.47959184, 5404.34693878, 5441.00510204, 5537.91836735]

length_189_227 = [5644.14285714, 5622.73979592, 5667.58673469, 5696.71938776, 5737.53571429,
 5798.2755102,  5839.32142857, 5938.14795918, 5981.23469388, 6312.81632653,
 6043.30102041, 6290.41836735, 6068.53061224, 6113.60714286, 6149.16836735,
 6253.58163265, 6297.58673469, 6342.20408163, 6380.82653061, 6098.04591837,
 6134.19387755, 6172.45918367, 6233.17346939, 6316.05612245, 6366.13265306,
 6401.51530612, 6445.67346939, 6432.84183673, 6456.3877551,  6514.04081633,
 6557.6122449,  6640.34183673, 6682.38265306, 6726.41326531, 6763.58163265,
 6638.50510204, 6684.21938776, 6724.14285714, 6763.98979592]

length_228_255 = [6871.9744898,  6912.76530612, 6961.79591837, 7004.19387755, 6975.80102041,
 7025.08673469, 7073.19897959, 7121.10714286, 7215.82653061, 7261.89795918,
 7310.26530612, 7363.14795918, 7055.31632653, 7106.56632653, 7146.71938776,
 7193.8877551,  7292.35714286, 7341.56632653, 7391.46428571, 7432.20408163,
 7410.06122449, 7451.69387755, 7489.95918367, 7526.84693878, 7537.,
 7537. ,        7537.        ]


lengths = length_1_23 + length_24_93 + length_94_126 + length_127_128 + length_129_154 + length_155_188 + length_189_227 + length_228_255


def get_bit_weight(data, bit):
    bit_val = 1 << bit
    jump = bit_val + 1
    val1_index = []
    val2_index = []
    for i in range(len(data)):
        if i % (bit_val*2) == 0:
            val1_index += range(i, i + bit_val)
            val2_index += range(i + bit_val, i + 2 *bit_val)
    # Since we don't have value 0
    val1_index = val1_index[1:]
    val2_index = val2_index[1:]
    #print(val1_index)
    #print(val2_index)
    diff = []
    for i1, i2 in zip(val1_index, val2_index):
        if i2 > len(data):
            continue
        diff.append(data[i2-1] - data[i1-1])    # Since begins at 1
    diff_np = np.array(diff)
    diff_np = diff_np[diff_np!=0]
    return np.mean(np.array(diff_np))


for i in range(0, 8):
    bit_val = get_bit_weight(lengths, i)
    print("Bit " + str(i) + " = " + str(bit_val))

plt.plot(np.arange(1, 254), np.array(lengths))
# plt.title("Durée réelle de la fenêtre en fonction du code.")
plt.xlabel('Configuration de durée de la fenêtre')
plt.ylabel('Durée réelle de la fenêtre (ps)')
plt.show()

